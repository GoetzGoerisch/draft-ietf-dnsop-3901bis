<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE rfc [
	<!ENTITY nbsp    "&#160;">
	<!ENTITY zwsp   "&#8203;">
	<!ENTITY nbhy   "&#8209;">
	<!ENTITY wj     "&#8288;">
]>
<?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
<!-- generated by https://github.com/cabo/kramdown-rfc version 1.7.1 (Ruby 3.1.4) -->
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" ipr="trust200902" docName="draft-momoka-dnsop-3901bis-latest" category="info" submissionType="IETF" tocInclude="true" sortRefs="true" symRefs="true" version="3">
	<!-- xml2rfc v2v3 conversion 3.18.2 -->
	<front>
		<title abbrev="3901bis">DNS IPv6 Transport Operational Guidelines</title>
		<seriesInfo name="Internet-Draft" value="draft-momoka-dnsop-3901bis-latest"/>
		<author fullname="山本 桃歌" asciiFullname="Momoka Yamamoto">
			<organization>The University of Tokyo/WIDE Project</organization>
			<address>
				<email>momoka.my6@gmail.com</email>
			</address>
		</author>
		<author fullname="Tobias Fiebig" initials="T." surname="Fiebig">
				<organization abbrev="MPI-INF">Max-Planck-Institut fuer Informatik</organization>
				<address>
						<postal>
							<street>Campus E14</street>
							<city>Saarbruecken</city>
							<code>66123</code>
							<country>Germany</country>
						</postal>
						<phone>+49 681 9325 3527</phone>
						<email>tfiebig@mpi-inf.mpg.de</email>
				</address>
		</author>
		<date year="2023" month="October" day="20"/>
		<area>Ops</area>
		<workgroup>dnsop</workgroup>
		<keyword>DNS</keyword>
		<keyword>IPv6</keyword>
		<abstract>
	<t>
		This memo provides guidelines and documnets Best Current Practice for operating authoritative and recursive DNS servers given that queries and responses are carried in a mixed environment of IPv4 and IPv6 networks.
		It expands beyond RFC3901 in so far that it now considers the reality of progressing IPv4 exhaustion, which will make IPv6 only resolvers necessary in the long-term.
	</t>
		</abstract>
		<note removeInRFC="true">
			<name>Discussion Venues</name>
			<t>Source for this draft and an issue tracker can be found at
		<eref target="https://github.com/momoka0122y/draft-dnsop-3901bis"/>.</t>
		</note>
	</front>
	<middle>

		<section anchor="introduction">
			<name>Introduction</name>
			<t>
				Despite IPv6 being first discussed in the mid 1990s <xref target="RFC1883"/>, consistent deployment thorughout the whole Internet has not yet been accomplished.
				Hence, today, the Internet is a mixture of IPv4, dual-stack (networks connected via both IP versions), and IPv6 networks.
			</t>
			<t>
				This creates a complex landscape where authoritative name servers might be accessible only via specific network protocols.
				At the same time, DNS resolvers may only be able to access the Internet via either IPv4 or IPv6. This poses a challenge for such resolvers, as they may encounter names for which queries have to be sent to authoritative name servers with which they do not share an IP version during the name resolution process.
			</t>
			<t>In this document, we discuss:</t>
			<ul spacing="normal">
				<li>
					<t>IP version related namespace fragmentation and best-practices for avoiding it.</t>
				</li>
				<li>
					<t>Guidelines for configuring authorative name servers for zones.</t>
				</li>
				<li>
					<t>Guidelines for operating recursive DNS resolvers.</t>
				</li>
			</ul>
			<t>
				While transitional technologies and dual-stack setups may mitigate some of the issues of DNS reolution in a mixed protocol-version Internet, making DNS data accessible over both IPv4 and IPv6 is the most robust and flexible approach, as it allows resolvers to reach the information they need without requiring intermediary translation or forwarding services which may introduce additional failure cases.
			</t>
			<section anchor="requirements-language">
				<name>Requirements Language</name>
				<t>
					The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
					"SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
					"OPTIONAL" in this document are to be interpreted as described in BCP
					14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they appear in all
					capitals, as shown here.
				</t>
			</section>
		</section>
		<section anchor="terminology">
			<name>Terminology</name>
			<t>
				This document uses DNS terminology as described in <xref target="RFC8499"/>.
				Furthermore, the following terms are used with a defined meaning:
			</t>
			<ul spacing="normal">
				<li>
					<t>
						"IPv4 name server": This refers to a name server providing DNS services reachable via IPv4. It does not imply anything about what DNS data is served, but requires DNS queries to be received and answered over IPv4.
					</t>
				</li>
				<li>
					<t>
						"IPv6 name server": This refers to a name server providing DNS services reachable via IPv6. It does not imply anything about what DNS data is served, but requires DNS queries to be received and answered over IPv6.
					</t>
				</li>
				<li>
					<t>
						"dual-stack name server": A name server that is both an "IPv4 name server" and also an "IPv6 name server".
					</t>
				</li>
			</ul>
		</section>
		<section anchor="name-space-fragmentation">
			<name>Name Space Fragmentation</name>
			<t>
				A resolver that tries to look up a name starts out at the root, and follows referrals until it is referred to a name server that is authoritative for the name.
				If somewhere down the chain of referrals it is referred to a name server that is, based on the referral, only accessible over a transport which the resolver cannot use, the resolver is unable to continue DNS resolution.
			</t>
			<t>
				If this occurs, the DNS has, effectively, fragmented based on the resolver's and authoritative's mismatching IP version support.
			</t>
			<t>
				In a mixed IP Internet, this fragmentation can be due to DNS zones being consistently configured to only support either IPv4 or IPv6, or due to misconfigurations leading to a situation where a zone is not resolvable by either IPv4 or IPv6 only resolvers due to a misconfiguration.
				The latter cases are often hard to identify, as the impact of misconfigurations for only one IP version (IPv4 or IPv6) may be hidden in a dual-stack setting.
				In the worst case, a specific name may only be resolvable via dual-stack enabled resolvers.
			</t>
			<section anchor="misconfigurations-causing-ip-version-related-name-space-fragmentation">
				<name>Misconfigurations Causing IP Version Related Name Space Fragmentation</name>
				<t>
					Even when an administrator thinks they have enabled support for a specific IP version on their authoritative name server, various misconfigurations may break the DNS delegation chain of a zone for that protocol and prevent any of its records from resolving for clients only supporting that IP version.
					These misconfigurations can be kept hidden if most clients can successfully fall back to the other IP version.
					As such, these issues are more common for IPv6 resolution related name space fragmentation.
				</t>
				<t>
					The following name related misconfigurations can cause broken delegation for one IP version:
				</t>
				<ol spacing="normal" type="1">
					<li>
						<t>
							No A/AAAA records for NS names: If none of the NS records for a zone in their parent zone have associated A or AAAA records, while holding the inverse record, resolution via the concerned IP version is not possible.
						</t>
					</li>
					<li>
						<t>
							Missing GLUE: If the name from an NS record for a zone is in-bailiwick, i.e., the name is within the zone or below, a parent zone must contain an IPv4 and IPv6 GLUE record, i.e., a parent must serve the corresponding A or AAAA record(s) as ADDITIONAL data when returning the NS record in the ANSWER section.
						</t>
					</li>
					<li>
						<t>
							No A/AAAA record for in-bailiwick NS : If an NS record of a zone points to a name that is in-bailiwick but the name lacks corresponding A or AAAA record(s) in its zone, resolution via the concerned IP version will fail even if the parent provides GLUE, when the recursive server validates the delegation path.
						</t>
					</li>
					<li>
						<t>
							Zone of out-of-bailiwick NSes not resolving: If an NS record of a zone is out-of-bailiwick, the corresponding zone must be resolvable via the IP version in question as well. It is insufficient if the name pointed to by the NS record has an associated A or AAAA record correspondingly.
						</t>
					</li>
					<li>
						<t>
							Parent zone not resolvable via one IP version: For a zone to be resolvable via an IP version the parent zones up to the root zone must be resolvable via that IP version as well. Any zone not resolvable via the concerned IP version breaks the delegation chain for all its children.
						</t>
					</li>
				</ol>
				<t>
					The above misconfigurations are not mutually exclusive.
				</t>
				<t>
					Furthermore, any of the misconfigurations above may also materialize not via a missing RR but via an RR providing the IP address of a nameserver that is not configured to answer queries via that IP version.
				</t>
			</section>
			<section anchor="reasons-for-intentional-ip-version-related-name-space-fragmentation">
				<name>Reasons for Intentional IP Version Related Name Space Fragmentation</name>
				<t>
					Intentional IP related name space fragmentation occurs if an operator consciously decides to not deploy IPv4 or IPv6 for a part of the resolution chain.
					Most commonly, this is realized by consciously implementing points 1-3 from the above list.
				</t>
			</section>
		</section>
		<section anchor="policy-based-avoidance-of-name-space-fragmentation">
			<name>Policy Based Avoidance of Name Space Fragmentation</name>
			<t>
				With the final exhaustion of IPv4 pools in RIRs and the progressing deployment of IPv6, there no longer is a "preferred" IP version.
				Yet, while we now observe the first zones becoming exclusively IPv6 resolvable, we also still see a major portion of zones solely relying on legacy IP.
				Hence, at the moment, dual stack connectivity is instrumental to be able to resolve zones.
			</t>
			<t>
				Having zones served only by name servers reachable via one IP version would fragment the DNS.
				Hence, we need to find a way to avoid this fragmentation.
			</t>
			<t>
				The recommended approach to maintain name space continuity is to use administrative policies, as described in this section.
			</t>
			<section anchor="guidelines-for-dns-zone-configuration">
				<name>Guidelines for DNS Zone Configuration</name>
				<t>
					It is usually recommended that DNS zones contain at least two name servers, which are geographically diverse and operate under different routing policies.
					To reduce the chance of dns name space fragmentation, it is <bcp14>RECOMMENDED</bcp14> that at least two NS for a zone are dual stack name servers.
					Specitifcally, this means that the folowing minimal requirements hold:
				</t>
				<ul spacing="normal">
					<li>
						<t>
							IPv4 adoption:
							Every authoritative DNS zone <bcp14>SHOULD</bcp14> be served by at least one IPv4-reachable authoritative name server to maintain name space continuity.
							The delegation configuration (Resolution of the parent, resolution of out-of-bailiwick names, GLUE) <bcp14>MUST</bcp14> not rely on IPv6 connectivity being available.
							As we acknowledge IPv6 scarcity, operators MAY opt to not provide DNS services via IPv4, if they can ensure that all clients expected to resolve this zone do support DNS resolution via IPv6.
						</t>
					</li>
					<li>
						<t>
							IPv6 Adoption:
							Every authoritative DNS zone <bcp14>SHOULD</bcp14> be served by at least one IPv6-reachable authoritative name server to maintain name space continuity.
							The delegation configuration (Resolution of the parent, resolution of out-of-bailiwick names, GLUE) <bcp14>MUST</bcp14> not rely on IPv6 connectivity being available.
						</t>
					</li>
					<li>
						<t>
							Consistency:
							Both IPv4 and IPv6 transports should serve identical DNS data to ensure a consistent resolution experience across different network types.
						</t>
					</li>
					<li>
						<t>
							Note: zone validation processes <bcp14>SHOULD</bcp14> ensure that there is at least one IPv4 address record and one IPv6 address record available for the name servers of any child delegations within the zone.
						</t>
					</li>
				</ul>
			</section>
			<section anchor="guidelines-for-dns-resolvers">
				<name>Guidelines for DNS Resolvers</name>
				<t>
					Every iterative name server <bcp14>SHOULD</bcp14> be either IPv6-only with a transition mechanism for IPv4 reachability or dual stack.
				</t>
				<t>
					The zones a IPv6-only iterative resolvers can resolve are growing but as they cannot fully resolve all zones, the use of a transition mechanism is <bcp14>RECOMMENDED</bcp14> "cite other draft".
				</t>
				<t>
					Alternatively, in absence of a transition mechanism, IPv6 only resolvers MAY use a configuration where such resolvers forward queries failing IPv6 only DNS resolution to a set of dual-stack recursive name servers that perform the actual recursive queries.
				</t>
			</section>
		</section>
		<section anchor="security-considerations">
			<name>Security Considerations</name>
			<t>
				TODO: This requires some input as, e.g., dual-stack services have implications for ratelimiting etc.
			</t>
			<t>
				The guidelines described in this memo introduce no new security considerations into the DNS protocol or associated operational scenarios.
			</t>
		</section>
		<section anchor="iana-considerations">
			<name>IANA Considerations</name>
			<t>
				This document does not require IANA actions.
			</t>
		</section>
		<section numbered="false" anchor="acknowledgments">
			<name>Acknowledgments</name>
			<t>
				TODO: acknowledge people.
			</t>
			<t>
				Thank you for reading this draft.
			</t>
		</section>
	</middle>
	<back>
		<references>
			<name>References</name>
			<references anchor="sec-normative-references">
				<name>Normative References</name>
				<reference anchor="RFC2119">
					<front>
						<title>Key words for use in RFCs to Indicate Requirement Levels</title>
						<author fullname="S. Bradner" initials="S." surname="Bradner"/>
						<date month="March" year="1997"/>
						<abstract>
							<t>In many standards track documents several words are used to signify the requirements in the specification. These words are often capitalized. This document defines these words as they should be interpreted in IETF documents. This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t>
						</abstract>
					</front>
					<seriesInfo name="BCP" value="14"/>
					<seriesInfo name="RFC" value="2119"/>
					<seriesInfo name="DOI" value="10.17487/RFC2119"/>
				</reference>
			</references>
			<references anchor="sec-informative-references">
				<name>Informative References</name>
				<reference anchor="RFC1883">
					<front>
						<title>Internet Protocol, Version 6 (IPv6) Specification</title>
						<author fullname="S. Deering" initials="S." surname="Deering"/>
						<author fullname="R. Hinden" initials="R." surname="Hinden"/>
						<date month="December" year="1995"/>
						<abstract>
							<t>This document specifies version 6 of the Internet Protocol (IPv6), also sometimes referred to as IP Next Generation or IPng. [STANDARDS-TRACK]</t>
						</abstract>
					</front>
					<seriesInfo name="RFC" value="1883"/>
					<seriesInfo name="DOI" value="10.17487/RFC1883"/>
				</reference>
				<reference anchor="RFC8174">
					<front>
						<title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
						<author fullname="B. Leiba" initials="B." surname="Leiba"/>
						<date month="May" year="2017"/>
						<abstract>
							<t>RFC 2119 specifies common key words that may be used in protocol specifications. This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the defined special meanings.</t>
						</abstract>
					</front>
					<seriesInfo name="BCP" value="14"/>
					<seriesInfo name="RFC" value="8174"/>
					<seriesInfo name="DOI" value="10.17487/RFC8174"/>
				</reference>
				<reference anchor="RFC8499">
					<front>
						<title>DNS Terminology</title>
						<author fullname="P. Hoffman" initials="P." surname="Hoffman"/>
						<author fullname="A. Sullivan" initials="A." surname="Sullivan"/>
						<author fullname="K. Fujiwara" initials="K." surname="Fujiwara"/>
						<date month="January" year="2019"/>
						<abstract>
							<t>The Domain Name System (DNS) is defined in literally dozens of different RFCs. The terminology used by implementers and developers of DNS protocols, and by operators of DNS systems, has sometimes changed in the decades since the DNS was first defined. This document gives current definitions for many of the terms used in the DNS in a single document.</t>
							<t>This document obsoletes RFC 7719 and updates RFC 2308.</t>
						</abstract>
					</front>
					<seriesInfo name="BCP" value="219"/>
					<seriesInfo name="RFC" value="8499"/>
					<seriesInfo name="DOI" value="10.17487/RFC8499"/>
				</reference>
			</references>
		</references>
	</back>
</rfc>
